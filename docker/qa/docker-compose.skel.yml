---

#
# default QA composition.
#
# variable defaults:
#  SUBDOMAIN: @CLIENT_CODE
#             VTB
#
#  DOMAIN: @ENV.blueacorn.net
#          qa-1.blueacorn.net
#
# !!! DO NOT EDIT THIS FILE !!!
# To make changes, save as docker-compose.yml.
#  docker-compose.yml takes precendce over docker-compose.skel.yml
# !!! DO NOT EDIT THIS FILE !!!
#

nginx:
  container_name: ${ENV}-${CLIENT_CODE}-nginx
  restart: unless-stopped
  image: registry.badevops.com/m1-nginx
  links:
    - phpfpm
    - term
  volumes:
    - /docker-volumes/m1-qa/${CLIENT_CODE}/${ENV}-magento:/magento

  environment:
    VIRTUAL_HOST: "${SUBDOMAIN}.${DOMAIN}"
    APP_ROOT: ${APP_ROOT}

# nginx_deux:
#   container_name: ${ENV}-${CLIENT_CODE}-nginx-deux
#   image: registry.badevops.com/m1-nginx
#   links:
#     - phpfpm
#     - term
#   volumes:
#     - /docker-volumes/m1-qa/${CLIENT_CODE}/${ENV}-magento:/magento
#
#   environment:
#     VIRTUAL_HOST: "deux.${DOMAIN}"
#     APP_ROOT: ${APP_ROOT}
#     MAGE_RUN_CODE: "deux"

phpfpm:
  container_name: ${ENV}-${CLIENT_CODE}-phpfpm
  restart: unless-stopped
  image: registry.badevops.com/m1-phpfpm:5.5
  links:
    - mysql
  volumes:
    - /docker-volumes/m1-qa/${CLIENT_CODE}/${ENV}-magento:/magento

term:
  container_name: ${ENV}-${CLIENT_CODE}-term
  restart: unless-stopped
  build: ./
  dockerfile: Dockerfile-term
  links:
    - mysql
  volumes:
    - /docker-volumes/m1-qa/${CLIENT_CODE}/${ENV}-magento:/magento
    - /nfs:/nfs:ro

  environment:
    CLIENT_CODE: ${CLIENT_CODE}
    SNAPSHOT_BASE_ENV: ${SNAPSHOT_BASE_ENV}
    APP_URL: ${APP_URL}
    REPO_REMOTE: ${REPO_REMOTE}
    REPO_REF: ${REPO_REF}
    MYSQL_USER: magento
    MYSQL_PASSWORD: magento
    MYSQL_DATABASE: magento
    OAUTH_DOMAIN: auth.blueacorn.net
    OAUTH_APP: ${CLIENT_CODE}-${ENV}

mysql:
  container_name: ${ENV}-${CLIENT_CODE}-mysql
  restart: unless-stopped
  image: mariadb:10
  volumes:
    - /docker-volumes/m1-qa/${CLIENT_CODE}/${ENV}-mysql:/var/lib/mysql

  environment:
    MYSQL_USER: magento
    MYSQL_PASSWORD: magento
    MYSQL_DATABASE: magento
    MYSQL_ROOT_PASSWORD: lowfi

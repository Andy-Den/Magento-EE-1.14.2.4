---

- name: ensure HTTPD_USER writable paths (nosudo)
  file:
    path: "{{ item }}"
    owner: "{{ ansible_ssh_user }}"
    group: "{{ HTTPD_USER }}"
    mode: 0770
    state: directory
  become: False
  when: ansible_ssh_user == HTTPD_USER
  with_items: "{{ WRITABLE_PATHS }}"
  ignore_errors: yes
  tags:
    - filesystem
    - filesystem-perms-only


- name: ensure HTTPD_USER writable paths (sudo)
  file:
    path: "{{ item }}"
    owner: "{{ ansible_ssh_user }}"
    group: "{{ HTTPD_USER }}"
    mode: 0770
    state: directory
  become: True
  when: ansible_ssh_user != HTTPD_USER
  with_items: "{{ WRITABLE_PATHS }}"
  ignore_errors: yes
  tags:
    - filesystem
    - filesystem-perms-only

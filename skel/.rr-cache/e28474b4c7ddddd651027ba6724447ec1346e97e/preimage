---

#
# default dockerized environment composition.
#
# variable defaults:
#  SUBDOMAIN: @CLIENT_CODE
#             VTB
#
#  DOMAIN: @ENV.blueacorn.net
#          qa-1.blueacorn.net
#
# !!! DO NOT EDIT THIS FILE !!!
#
# To make changes, save as docker-compose.yml.
#
# You can alsp provide a per-environment composition
# by saving in the environment directory, e.g.
#   skel/env/production/docker-compose.yml
#
# !!! DO NOT EDIT THIS FILE !!!
#

nginx:
  container_name: ${ENV}-${CLIENT_CODE}-nginx
  restart: unless-stopped
  image: registry.badevops.com/mage-nginx:m1
  links:
    - phpfpm
    - term
    - smtp
    - phpdev
  volumes_from:
    - phpfpm
  environment:
    VIRTUAL_HOST: "${SUBDOMAIN}.${DOMAIN}"
    APP_ROOT: ${APP_ROOT}

    # disable HTTP basic auth by providing empty ("") values
    AUTH_BASIC_USER: "blueacorn"
    AUTH_BASIC_PASS: "pass4blueacorn"

# nginx_deux:
#   container_name: ${ENV}-${CLIENT_CODE}-nginx-deux
#   image: registry.badevops.com/mage-nginx:m1
#   links:
#     - phpfpm
#     - term
#     - smtp
#   volumes_from:
#     - phpfpm
#
#   environment:
#     VIRTUAL_HOST: "deux.${DOMAIN}"
#     APP_ROOT: ${APP_ROOT}
#     MAGE_RUN_CODE: "deux"
#     AUTH_BASIC_USER: "blueacorn"
#     AUTH_BASIC_PASS: "pass4blueacorn"

phpfpm:
  container_name: ${ENV}-${CLIENT_CODE}-phpfpm
  restart: unless-stopped
  image: registry.badevops.com/mage-phpfpm:m1
  links:
    - smtp
    - mysql
  volumes:
    - /docker-volumes/dockerized-envs/${CLIENT_CODE}-${ENV}-magento:/home/blueacorn/magento

cron:
  container_name: ${ENV}-${CLIENT_CODE}-cron
  restart: unless-stopped
  log_driver: none
  image: registry.badevops.com/mage-cron:m1
  links:
    - mysql
    - smtp
  volumes_from:
    - phpfpm
  environment:
    APP_ROOT: ${APP_ROOT}
    CRON_LOG_DIR: ${APP_ROOT}/var/log

mysql:
  container_name: ${ENV}-${CLIENT_CODE}-mysql
  restart: unless-stopped
  image: mariadb:10
  volumes:
    - /docker-volumes/dockerized-envs/${CLIENT_CODE}-${ENV}-mysql:/var/lib/mysql

  environment:
    MYSQL_USER: magento
    MYSQL_PASSWORD: magento
    MYSQL_DATABASE: magento
    MYSQL_ROOT_PASSWORD: lowfi

#
# /devops/ services
#
phpdev:
  container_name: ${ENV}-${CLIENT_CODE}-phpdev
  image: registry.badevops.com/mage-phpdev:latest
  links:
    - mysql
  volumes_from:
    - phpfpm

term:
  container_name: ${ENV}-${CLIENT_CODE}-term
  restart: unless-stopped
  build: ./
  dockerfile: Dockerfile-term.skel
  links:
    - mysql
    - smtp
  volumes_from:
    - phpfpm
    - cron
  volumes:
    - /nfs:/nfs:ro

  environment:
    APP_URL: ${APP_URL}
    APP_ROOT: ${APP_ROOT}
    CLIENT_CODE: ${CLIENT_CODE}
    REPO_REMOTE: ${REPO_REMOTE}
    REPO_REF: ${REPO_REF}
    SNAPSHOT_BASE_ENV: ${SNAPSHOT_BASE_ENV}
    MYSQL_USER: magento
    MYSQL_PASSWORD: magento
    MYSQL_DATABASE: magento
    OAUTH_DOMAIN: auth.blueacorn.net
    OAUTH_APP: ${CLIENT_CODE}-${ENV}

smtp:
  container_name: ${ENV}-${CLIENT_CODE}-smtp
  image: registry.badevops.com/mage-smtp
  log_driver: none
<<<<<<<
=======

mysql:
  container_name: ${ENV}-${CLIENT_CODE}-mysql
  restart: unless-stopped
  image: mariadb:10
  volumes:
    - /docker-volumes/dockerized-envs/${CLIENT_CODE}-${ENV}-mysql:/var/lib/mysql

  environment:
    MYSQL_USER: magento
    MYSQL_PASSWORD: magento
    MYSQL_DATABASE: magento
    MYSQL_ROOT_PASSWORD: lowfi
>>>>>>>

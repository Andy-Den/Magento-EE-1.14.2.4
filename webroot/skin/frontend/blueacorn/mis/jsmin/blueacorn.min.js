function BlueAcornCore(options) {
    this.init(options);
}

BlueAcornCore.prototype = {
    init: function(options) {
        this.settings = {
            debug: false,
            moduleName: "BlueAcornCore"
        };
        this.overrideSettings(this.settings, options);
        if (this.settings.debug === true) {
            this.setupDebugging(this.settings);
        }
    },
    overrideSettings: function(settings, options) {
        if (typeof options === "object") {
            settings = jQuery.extend(settings, options);
        }
    },
    setupDebugging: function(moduleSettings) {
        if (typeof moduleSettings === "object") {
            this.watchConsole(moduleSettings.moduleName + " Loaded!!!");
            this.watchConsole(moduleSettings);
        }
    },
    watchConsole: function(message) {
        if (this.settings.debug === true && $j("html.ie8, html.ie9, html.ie10").length === 0) {
            console.log(message);
        }
    }
};

var ba = new BlueAcornCore({
    debug: mageConfig["styleguide/development/enable_development"] > 0 ? true : false
});

function BlueAcornGlobal() {
    this.init();
}

jQuery(document).ready(function($) {
    BlueAcornGlobal.prototype = {
        init: function() {
            var self = this;
            self.setupObservers();
        },
        setupObservers: function() {
            this.moveMobileNavigation();
        },
        moveMobileNavigation: function() {
            var self = this;
            enquire.register("screen and (max-width:" + bp.medium + "px)", {
                match: function() {
                    $(".logo").after($("#header-nav"));
                    $("#header-nav").prepend($(".store-phone"));
                },
                unmatch: function() {
                    $(".skip-links").after($("#header-nav"));
                    $(".account-cart-wrapper").prepend($(".store-phone"));
                }
            });
        }
    };
    ba.Global = new BlueAcornGlobal();
});

function CustomFormElements(options) {
    this.init(options);
}

jQuery(document).ready(function($) {
    CustomFormElements.prototype = {
        init: function(options) {
            this.settings = {
                moduleName: "CustomFormElements",
                superSelects: false,
                blackList: [ ".no-style" ]
            };
            ba.overrideSettings(this.settings, options);
            ba.setupDebugging(this.settings);
            this.setObservers();
            this.updateAll();
        },
        setObservers: function() {
            var self = this;
            $(document).on("update:radios", function() {
                self.customRadios();
                self.unsetCustom();
            });
            $(document).on("update:checkboxes", function() {
                self.customCheckboxes();
                self.unsetCustom();
            });
            $(document).on("section:update", this.updateAll.bind(this));
            $(document).on("update:inputs", this.updateAll.bind(this));
            if (!this.settings.superSelects) {
                $(document).on("update:selects", function() {
                    self.updateSelects();
                    self.updateShivs();
                    self.unsetCustom();
                });
                $(window).on("resize", function() {
                    self.updateSelects();
                    self.unsetCustom();
                });
            }
        },
        updateAll: function() {
            this.customRadios();
            this.customCheckboxes();
            if (!this.settings.superSelects) {
                this.customSelects();
                this.updateShivs();
            }
            this.unsetCustom();
        },
        getLabel: function(el) {
            var elementLabel;
            if ($(el).siblings("label, span.label").length) {
                elementLabel = $(el).siblings("label, span.label").first();
            } else if ($(el).parent().siblings("label, span.label").length) {
                elementLabel = $(el).parent().siblings("label, span.label").first();
            } else if ($(el).parent("label").length) {
                elementLabel = $(el).parent("label");
            } else {
                $(el).after('<label for="' + $(el).attr("id") + '"></label>');
                elementLabel = $(el).siblings("label");
            }
            return elementLabel;
        },
        getLabelType: function(el) {
            var labelType = "label";
            if ($(el).siblings("span.label").length || $(el).parent().siblings("span.label").length) {
                labelType = "span";
            }
            return labelType;
        },
        resetLabels: function(el, type) {
            $(el).removeClass(type + " disabled checked");
        },
        setProperties: function(labelElement, labelInput, prop) {
            if ($(labelInput).prop(prop) && labelElement) {
                $(labelElement).addClass(prop);
            }
        },
        getLabelInput: function(labelType, labelElement) {
            var labelFor, labelInput;
            if (labelType === "label") {
                labelFor = $(labelElement).attr("for");
                if (labelFor.indexOf(":") != "-1") {
                    labelFor = labelFor.replace(":", "\\:");
                }
                labelInput = $("#" + labelFor + ', input[name="' + labelFor + '"]');
            } else {
                labelInput = $(labelElement).siblings("input");
            }
            return labelInput;
        },
        customRadios: function() {
            var radioElements = $('input[type="radio"].radio'), self = this;
            if ($(radioElements).length > 0) {
                $(radioElements).each(function(idx, el) {
                    var radioLabel, labelType;
                    radioLabel = self.getLabel(el);
                    labelType = self.getLabelType(el);
                    this.resetLabels(radioLabel, "radio-label");
                    this.setProperties(radioLabel, el, "checked");
                    this.setProperties(radioLabel, el, "disabled");
                    if (radioLabel) {
                        $(radioLabel).addClass("radio-label");
                        $(el).addClass("input-custom");
                        $(radioLabel).on("click", function(event) {
                            event.stopPropagation();
                            event.preventDefault();
                            var labelRadio = $(event.target).closest(labelType), radioInput = this.getLabelInput(labelType, labelRadio), groupRadio = $(radioInput).attr("name");
                            if (!$(radioInput).prop("disabled")) {
                                this.updateRadioGroup(groupRadio, labelType);
                                $(radioInput).prop("checked", true);
                                $(labelRadio).addClass("checked");
                            }
                            if ($(radioInput).attr("onclick")) {
                                $(radioInput).trigger("click");
                            }
                        }.bind(this));
                    }
                }.bind(this));
            }
        },
        updateRadioGroup: function(group, labelType) {
            $('input[name="' + group + '"]').each(function(idx, el) {
                $(el).prop("checked", false);
                $(el).siblings(labelType).removeClass("checked");
                if ($(el).parent("label").length > 0) {
                    $(el).parent("label").removeClass("checked");
                }
            });
        },
        customCheckboxes: function() {
            var self = this, checkboxElements = $('input[type="checkbox"].checkbox');
            if ($(checkboxElements).length > 0) {
                $(checkboxElements).each(function(idx, el) {
                    var checkboxLabel, labelType;
                    checkboxLabel = self.getLabel(el);
                    labelType = self.getLabelType(el);
                    this.resetLabels(checkboxLabel, "checkbox-label");
                    this.setProperties(checkboxLabel, el, "checked");
                    this.setProperties(checkboxLabel, el, "disabled");
                    if (checkboxLabel) {
                        $(checkboxLabel).addClass("checkbox-label");
                        $(el).addClass("input-custom");
                        $(checkboxLabel).off("click").on("click", function(event) {
                            event.stopPropagation();
                            event.preventDefault();
                            var labelCheckbox = $(event.target).closest(labelType), checkboxInput = this.getLabelInput(labelType, labelCheckbox);
                            if ($(checkboxInput).prop("checked")) {
                                $(labelCheckbox).removeClass("checked");
                                $(checkboxInput).prop("checked", false);
                            } else {
                                $(labelCheckbox).addClass("checked");
                                $(checkboxInput).prop("checked", true);
                            }
                            if ($(checkboxInput).attr("onclick")) {
                                $(checkboxInput)[0].onclick.apply($(checkboxInput)[0]);
                            }
                        }.bind(this));
                    }
                }.bind(this));
            }
        },
        customSelectsBefore: function() {
            var smallSelects = $("#select-language, .toolbar select, .review-heading .pager select, .review-customer-index .pager select, .small-select");
            $(smallSelects).addClass("sm");
        },
        customSelects: function() {
            this.customSelectsBefore();
            var selectElements = $("select"), selectTruncate = 36;
            if ($(selectElements).length > 0) {
                $(selectElements).each(function(idx, el) {
                    var selectTitle, selectedOptions;
                    if ($(el).parent(".select-container").length > 0 || $(el).prop("multiple")) {
                        return;
                    }
                    if ($(el).attr("title")) {
                        selectTitle = $(el).attr("title").strip().truncate(selectTruncate);
                    }
                    $(el).addClass("select-custom").data("truncate", selectTruncate);
                    if ($(el).prev().length > 0 && (!$(el).parent().hasClass("input-box") || !$(el).parent().hasClass("v-fix"))) {
                        $(el).wrap('<div class="input-box"></div>');
                    }
                    $(el).parent().addClass("select-container");
                    if ($(el).prop("disabled")) {
                        $(el).parent().addClass("disabled");
                    } else {
                        $(el).parent().removeClass("disabled");
                    }
                    if ($(el).hasClass("sm")) {
                        $(el).parent().addClass("small");
                    }
                    selectTitle = $(el).children().first().html().strip().truncate(selectTruncate);
                    selectedOptions = $(el).children("option:selected").text();
                    if (selectedOptions.length > 0) {
                        selectTitle = selectedOptions.strip().truncate(selectTruncate);
                    }
                    if ($(el).siblings(".custom-shiv").length === 0) {
                        var selectSize = "";
                        $(el).before('<span class="custom-shiv">' + selectTitle + "<span></span></span>");
                    }
                    $(el).on("change", this.updateShivs.bind(this));
                    $(el).on("mouseover", function() {
                        $(el).siblings(".custom-shiv").addClass("hover");
                    });
                    $(el).on("mouseout", function() {
                        $(el).siblings(".custom-shiv").removeClass("hover");
                    });
                    this.updateSelects();
                }.bind(this));
            }
        },
        updateShivs: function() {
            var selectShivs = $(".custom-shiv");
            $(selectShivs).each(function() {
                var selectElement, optionValue, truncateOption;
                selectElement = $(this).siblings("select");
                optionValue = $(selectElement).children("option:selected").text();
                truncateOption = $(selectElement).data("truncate");
                $(this).html(optionValue.strip().truncate(truncateOption) + "<span></span>");
            });
        },
        updateSelects: function() {
            var selectShivs = $(".custom-shiv");
            $(selectShivs).each(function() {
                if ($(this).siblings("select").css("display") === "none") {
                    $(this).css("display", "none");
                } else {
                    $(this).css("display", "");
                }
                $(this).parent(".select-container").removeClass("disabled");
                if ($(this).siblings("select").prop("disabled")) {
                    $(this).parent(".select-container").addClass("disabled");
                }
            });
        },
        unsetCustom: function() {
            var self = this;
            $.each(self.settings.blackList, function(idx, listItem) {
                $.each($(listItem), function(idx, el) {
                    if ($(el).prop("tagName") == "SELECT") {
                        self.unsetCustomSelect(el);
                    } else {
                        self.unsetCustomInput(el);
                    }
                });
            });
        },
        unsetCustomSelect: function(el) {
            $(el).parent(".select-container").removeClass("select-container");
            $(el).removeClass("custom-select select-custom disabled");
            $(el).siblings(".custom-shiv").remove();
        },
        unsetCustomInput: function(el) {
            $(el).removeClass("input-custom");
            if ($(el).siblings(".radio-label, .checkbox-label").length > 0) {
                $(el).siblings(".radio-label, .checkbox-label").removeClass("radio-label checkbox-label");
            } else if ($(el).parent().siblings(".radio-label, .checkbox-label").length > 0) {
                $(el).parent().siblings(".radio-label, .checkbox-label").removeClass("radio-label checkbox-label");
            }
        }
    };
    ba.CustomFormElements = new CustomFormElements({});
});

function ResponsiveNotation(options) {
    this.init(options);
}

jQuery(document).ready(function($) {
    ResponsiveNotation.prototype = {
        init: function(options) {
            this.settings = {
                moduleName: "ResponsiveNotation",
                mobileClass: "resp-mobile",
                tabletClass: "resp-tablet",
                desktopClass: "resp-desktop"
            };
            ba.overrideSettings(this.settings, options);
            ba.setupDebugging(this.settings);
            $(document).trigger("rnote:loaded");
            this.setViewportClass();
        },
        setViewportClass: function() {
            var self = this;
            enquire.register("screen and (min-width:" + (bp.large + 1) + "px)", {
                match: function() {
                    $("html").addClass(self.settings.desktopClass);
                },
                unmatch: function() {
                    $("html").removeClass(self.settings.desktopClass);
                }
            }).register("screen and (min-width:" + (bp.small + 1) + "px) and (max-width:" + bp.large + "px)", {
                match: function() {
                    $("html").addClass(self.settings.tabletClass);
                },
                unmatch: function() {
                    $("html").removeClass(self.settings.tabletClass);
                }
            }).register("screen and (max-width:" + bp.small + "px)", {
                match: function() {
                    $("html").addClass(self.settings.mobileClass);
                },
                unmatch: function() {
                    $("html").removeClass(self.settings.mobileClass);
                }
            });
        }
    };
    ba.ResponsiveNotation = new ResponsiveNotation({});
});